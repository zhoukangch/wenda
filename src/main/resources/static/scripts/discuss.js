define("nowcoder/1.2.983/javascripts/site/discuss/post/discuss",["nc","cpn","./cpn/title","./cpn/type","./cpn/tagList","../../../component/tagInput","./cpn/column","./cpn/editor","../../../util/util","../../../component/editorSub/hEditor/index","ncPlugin/kindeditor/kindeditor","ncPlugin/kindeditor/kindeditor/themes/nowcoder/nowcoder.css","../../../core/siteConfig","./cpn/submit","../../../action/discuss","../../../util/ajax"],function(a){function b(){var a=this;a.info=s.clone(window.pageInfo),a.isAdmin=!!a.info.isAdmin,a.isIdentity=!!a.info.isIdentity,a.isEdit=!!a.info.edit}function c(){function a(a,b,d){d.renderTo=c;var g=new b(d);e[a]=g,f.push(g)}var b=this,c=b.getEl(),d=b.info,e=b.cpn={},f=b.cpnList=[],g=b.getDraft(),h=b.getPost(),i=u.split(g.tags||h.tags,",");a("title",w,{value:g.title||h.title}),a("type",x,{tips:"请选择相关话题后发布，如发布至无关话题下，帖子将被删除。",items:(d.postTypeArray||[]).sort(function(a,b){return a.pos-b.pos}),needSearch:!0,value:s.id(g.type)||s.id(h.type)}),a("tagList",y,{noCustom:!0,items:s.map(d.postTagArray,function(a){return{text:a.name,value:a.id}}),value:i}),b.isAdmin&&a("column",z,{value:{tags:i,zhuanlanTime:g.zhuanlanTime||h.zhuanlanTime}}),a("editor",A,{isAdmin:b.isAdmin,value:g.content||h.content}),a("submit",B,{})}function d(){var a=this,b=a.cpn,c=a.cpnList,d=t.frequency(500),e=t.frequency(500);b.submit.listen("cancel",s.bind(a.cancel,a)),b.submit.listen("submit",s.bind(a.submit,a)),s.forEach(c,function(b){b.listen("change",function(){d(s.bind(a.change,a))})}),b.title.listen("change",function(){e(function(){var a=b.title.val(),c=s.filter(["春招","内推","校招","实习","补招","面试"],function(b){return-1!==a.indexOf(b)});b.tagList.addTagByName(c)})})}function e(){function a(){f(function(){var a=b.cpn.editor,c=d.height()-e,f=0;s.forEach(b.cpnList,function(b){b.resize&&b.resize(),f+=b===a?0:b.getEl().outerHeight()}),a.fixHeight(c-g-f)})}var b=this,c=b.getEl(),d=r(window),e=C.getNavHeight(),f=t.frequency(250),g=parseInt(c.css("paddingTop"),10)+parseInt(c.css("paddingBottom"),10);r("div.nk-main").css("paddingTop",e),d.on("resize",a),a()}function f(a){var b=this,c=(b.info,b.cpn);if(0===arguments.length){var d,e=c.tagList.val()||[];if(c.column){var f=c.column.val();e=e.concat(f.tags||[]),d=f.zhuanlanTime}return{id:b.getPostId(),title:c.title.val(),type:c.type.val(),tags:e.join(","),content:c.editor.val(),zhuanlanTime:d}}var g=u.split(a.tags,",");c.title.val(a.title),c.type.val(a.type),c.editor.val(a.content),c.tagList.val(g),c.column&&c.column.val({tags:g,zhuanlanTime:a.zhuanlanTime})}function g(){var a=this,b=a.val(),c=a.cpn,d="";return b.title?b.title.length>30?d="文章标题最多输入30个字符":c.editor.editor.isEmpty()?d="文章内容不能为空":b.type&&"-1"!==b.type?"4"!==s.id(b.type)||a.isAdmin||(d="你不是管理员，你不能在站内公告板块发帖"):d="请选择话题版块，如发至不相关话题，管理员将删除您的发帖。":d="文章标题不能为空",d&&r(window).scrollTop(0),d&&v.alert(d),!d}function h(){var a=this,b=a.cpn,c=a.val(),d=u.decodeHTML(c.content.replace(/<.*?>/g,"")),e=!a.isIdentity&&(/1\d{10}/.test(d)||/([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+/.test(d));b.submit.showTips(e),a.fetchSaveDraft(c)}function i(){var a=this;a.fetchDelDraft(function(){var b=a.getPostId();window.location.href=b?"/discuss/"+b:"/discuss"})}function j(){var a=this;if(a.check()){var b=v.mask("提交中，请稍等..."),c=a.isEdit,d=a.val();D[c?"editPost":"createPost"]({body:d,call:function(a){b.close();var e=v.tips(c?"编辑成功":"发布成功");e.listen("close",function(){var b=d.id||a.id;window.location.href=b?"/discuss/"+b:"/discuss"})},error:function(a){b.close(),v.alert(a.msg,function(){-1===a.code&&(window.location.href="/discuss")})}})}}function k(){var a=this,b=a.getPost();return s.id(b.id)}function l(){var a=this;return a.info.discussPost||{}}function m(){var a=this;return a.info.draftJs||{}}function n(a,b){var c=this;a=a||{},D.saveDiscussDraft({body:{type:E.draftType.post,entityId:c.getPostId(),content:a.content||"",title:a.title||"",discussType:a.type||"",tags:a.tags||""},always:b})}function o(a){var b=this;b.fetchSaveDraft({},a)}var p=a("nc"),q=a("cpn"),r=p.$,s=(p.Sys,p.Base),t=p.Time,u=p.Str,v=q.Popup,w=a("./cpn/title"),x=a("./cpn/type"),y=a("./cpn/tagList"),z=a("./cpn/column"),A=a("./cpn/editor"),B=a("./cpn/submit"),C=a("../../../util/util"),D=a("../../../action/discuss"),E=a("../../../core/siteConfig");C.page({_template:'<div class="discuss-publish js-content" style="padding:20px 0;background:#fff;"></div>',renderTo:r("#app"),renderBy:"replaceWith",listeners:[{name:"render",type:"custom",handler:function(){var a=this;a.initCpn(),a.initEvent(),a.initResize()}}]},{initialize:b,initCpn:c,initEvent:d,initResize:e,val:f,check:g,change:h,cancel:i,submit:j,getPostId:k,getPost:l,getDraft:m,fetchSaveDraft:n,fetchDelDraft:o})});
define("nowcoder/1.2.983/javascripts/site/discuss/post/cpn/column",["nc","cpn"],function(a,b,c){function d(){var a=this,b=a.getEl(".js-tags");a.tagMap={},l.forEach([{value:723,text:"每日话题"},{value:724,text:"牛客访谈"},{value:725,text:"编程之美"}],function(c){var d=new m({renderTo:b,text:c.text,value:c.value,needToggle:!0,listeners:{toggle:function(){a.fire("change")}}});a.tagMap[c.value]=d})}function e(){var a=this,b=a.getEl(".tags-box"),c=a.timeIpt=new n({renderTo:b,placeholder:"专栏结束时间"}),d=c.getEl();d.css("display","inline-block"),d.css("marginLeft",10);var e=o.show({target:d,ipt:c.inputEl,startDate:"now",endDate:o.yearDiff(5)+"-12-31 23:59:59",quickTool:!0,call:function(b,d){c.val(d),a.fire("change")}});a.pushChild(e)}function f(a){var b=this;if(0===arguments.length){var c=[];return l.forEach(b.tagMap,function(a){a.isChecked()&&c.push(a.val())}),{tags:c,zhuanlanTime:i.trim(b.timeIpt.val())}}b.timeIpt.val(i.trim(a.zhuanlanTime)),l.forEach(a.tags,function(a){var c=b.tagMap[a];c&&c.checked(!0)})}var g=a("nc"),h=a("cpn"),i=g.$,j=g.Component,k=g.Clazz,l=(g.Str,g.Base),m=h.Tag,n=h.Input,o=h.AttachDate,p=c.exports=k.create();k.mix(p,j,{_template:['<div class="discuss-tags discuss-line">','<span class="discuss-label" style="line-height:40px;">专栏：</span>','<div class="tags-box">','<span class="js-tags"></span>',"</div>","</div>"].join(""),listeners:[{name:"render",type:"custom",handler:function(){var a=this,b=a.rawConfig;a.initTags(),a.initTime(),b.value&&a.val(b.value)}}]},{initTags:d,initTime:e,val:f})});
define("nowcoder/1.2.983/javascripts/site/discuss/post/cpn/editor",["nc","../../../../util/util","../../../../component/editorSub/hEditor/index","ncPlugin/kindeditor/kindeditor","ncPlugin/kindeditor/kindeditor/themes/nowcoder/nowcoder.css","cpn","../../../../core/siteConfig"],function(a,b,c){function d(){var a=this,b=a.rawConfig,c=a.getEl();a.editor=new k({renderTo:c,height:150,isAdmin:!!b.isAdmin,placeholder:"输入描述，越详细越好哦",content:b.value,toolbarFixedTop:j.getNavHeight(),needChangeEditor:!0,needAt:!0,draftChange:function(){a.fire("change")},afterChangeEditor:function(b){a.editor=b,a.fixHeight()}})}function e(a){var b=this,c=b.editor;return 0===arguments.length?c.val():void c.val(a||"")}function f(a){var b=this,c=b.getEl(),d=b.editor;a=a||b._lastHeight,a&&(b._lastHeight=a,a=Math.max(a,150)-parseInt(c.css("paddingTop"),10)-parseInt(c.css("paddingBottom"),10),d.waitCreated&&d.waitCreated(function(){d.resize(null,a)}),!d.waitCreated&&d.resize("auto",a))}var g=a("nc"),h=(g.$,g.Component),i=g.Clazz,j=(g.Str,g.Base,a("../../../../util/util")),k=a("../../../../component/editorSub/hEditor/index"),l=c.exports=i.create();i.mix(l,h,{_template:'<div class="discuss-line"></div>',listeners:[{name:"render",type:"custom",handler:function(){var a=this;a.initCpn()}}]},{initCpn:d,val:e,fixHeight:f})});
define("nowcoder/1.2.983/javascripts/site/discuss/post/cpn/submit",["nc"],function(a,b,c){function d(a){var b=this,c=b.getEl();a=a!==!1,c.find(".js-tips")[a?"show":"hide"]()}var e=a("nc"),f=e.$,g=e.Component,h=e.Clazz,i=(e.Str,e.Base,c.exports=h.create());h.mix(i,g,{_template:['<div class="txtarea-foot discuss-line clearfix" style="padding-bottom:0;margin:0;">','<div class="warning-tips js-tips" style="display:none;"><i class="icon-warning-sign"></i> 注意！不要轻易泄露自己的联系方式哦</div>','<a href="javascript:void(0);" class="btn float-right btn-primary btn-modify-sure js-action" data-type="submit">发布</a>','<a href="javascript:void(0);" class="btn btn-default float-right btn-modify-cancel js-action" data-type="cancel">取消</a>',"</div>"].join(""),listeners:[{name:"render",type:"custom",handler:function(){}},{name:"click .js-action",handler:function(a){var b=this,c=f(a.currentTarget),d=f.trim(c.attr("data-type"));d&&b.fire(d)}}]},{showTips:d})});
define("nowcoder/1.2.983/javascripts/site/discuss/post/cpn/tagList",["nc","../../../../component/tagInput","cpn"],function(a,b,c){function d(a){var b=this,c=b.getAllTag();b.tagInput=new n({renderTo:b.getEl(),noCustom:!b.custom,limitStr:a.limitStr,common:a.common,getSuggest:b.custom?null:function(a,b){if(a){var d=l.searchRegExp(a);c=m.filter(c,function(a){return d.exec(a.text)})}b(c)},listeners:{change:function(){b.fire("change")}}})}function e(a){var b=this,c=b.tagInput;if(0===arguments.length)return c.val();if(b.custom){var d=[];m.forEach(a,function(a){a=i.trim(a),a&&d.push({value:a,text:a})}),c.val(d)}else{var d=[],e=m.toMap(b.getAllTag(),function(a){return{key:a.value,value:a}});m.forEach(a,function(a){e[a]&&d.push(e[a])}),c.val(d)}}function f(a){var b=this,c=b.tagInput,d=b.getAllTag(),e=m.toMap(d,function(a){return{key:a.text,value:a}});a=m.isArray(a)?a:[a],m.forEach(a,function(a){var b=e[a];b&&c.addTag(b)})}function g(){var a=this;return a._allTag=a.rawConfig.items||[],a._allTag.slice(0)}var h=a("nc"),i=h.$,j=h.Component,k=h.Clazz,l=h.Str,m=h.Base,n=a("../../../../component/tagInput"),o=c.exports=k.create();k.mix(o,j,{_template:'<div class="discuss-line"></div>',listeners:[{name:"render",type:"custom",handler:function(){var a=this,b=a.rawConfig;a.custom=!b.noCustom,a.initCpn(b),b.value&&a.val(b.value)}}]},{initCpn:d,val:e,addTagByName:f,getAllTag:g})});
define("nowcoder/1.2.983/javascripts/site/discuss/post/cpn/title",["nc"],function(a,b,c){function d(){var a=this;k.bindChange(a.ipt,function(){a.fire("change")})}function e(a){var b=this,c=b.ipt;return 0===arguments.length?h.trim(c.val()):void c.val(h.trim(a))}function f(){var a=this,b=a.getEl();a.ipt.outerWidth(b.width())}var g=a("nc"),h=g.$,i=g.Component,j=g.Clazz,k=(g.Base,g.Dom),l=c.exports=j.create();j.mix(l,i,{_template:['<div class="topic-selected-box discuss-line clearfix">','<div class="topic-publish">','<input type="text" class="col-sm-4 form-control input-file-title hide" placeholder="">',"</div>","</div>"].join(""),listeners:[{name:"render",type:"custom",handler:function(){var a=this,b=a.rawConfig,c=a.getEl(),d=a.ipt=c.find("input");d.attr("placeholder",b.placeholder||"文章标题：一句话说明你遇到的问题或想分享的经验"),a.initEvent(),a.val(b.value)}}]},{initEvent:d,val:e,resize:f})});
define("nowcoder/1.2.983/javascripts/site/discuss/post/cpn/type",["nc","cpn"],function(a,b,c){function d(a){var b=this,c=b.getEl();b.select=new l({renderTo:c,needSearch:!!a.needSearch,text:"选择板块",renderBy:"prepend",options:b.getOptions(),change:function(){b.fire("change")}})}function e(a){var b=this,c=b.select;return 0===arguments.length?c.val():void c.val(k.id(a))}function f(){var a=this,b=a.rawConfig.items;return k.map(b,function(a){return{text:a.name,value:k.id(a.id)}})}var g=a("nc"),h=a("cpn"),i=(g.$,g.Component),j=g.Clazz,k=g.Base,l=h.Select,m=c.exports=j.create();j.mix(m,i,{_template:'<div class="publish-type discuss-line"></div>',listeners:[{name:"render",type:"custom",handler:function(){var a=this,b=a.rawConfig,c=a.getEl();b.tips&&c.append(' <div class="error-tip">'+b.tips+"</div>"),a.initCpn(b),b.value&&a.val(b.value)}}]},{initCpn:d,val:e,getOptions:f})});